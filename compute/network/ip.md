---
网络: 网络 IP 数据包
---

# IP 数据包的格式

ip 数据包格式如下
 
![](.gitbook/assets/ip.png)


* 版本 IP 协议的版本， 目前协议版本号为4 下一代为6

* 首部长度， IP报文首部的长度。 固定部分的长度为20字节。 和可变长度之和。 一共占4位， 所以值最大是15， 但是单位是4字节。 所以IP报文首部长度最大是 15 \* 4 = 60字节。 出去固定部分的长度20字节， 可变长度最大为40字节. 举个例子， ICMP回显请求，有可能会打开RR选项（record route），会记录经过的路由，但是IP首部只有有限的空间来存放IP，只有可变长度选项里能够存，最大为40字节。一个ip地址为4字节， 因此最多能够存9个ip地址。

* 服务类型： 

* 总长度， ip报文的总长度， 首部+ 数据报文的 长度之和

* 标示 唯一的标示主机发送的每一份数据包， 通常每发送一个报文， 它的值加1， 当ip报文长度超过传输的MTU时候， 必须分片，这个标识字段的值被复制到所有数据分片的标示字段中， 似的这些分片在达到最终目的时候可以依照标识字段的内容重新组成原先的数据

* 片偏移， 本分片在原先数据报文中相对首部的偏移位置（需要再乘以8）， 所以使用标示和片偏移 两个值，才能重新组合起原来的数据报文

* 生存时间  IP报文云晓通过的路由器的最大数量，没经过一个路由器 TTL减去1 ， 当为0 时候， 路由器将该数据包文丢弃。 TTL字段的发送值 当前为64 但是回显时候 一般设置为最大值225。 ttl 可以防止网络出现环路时候， ip数据包无休止的传递下去

* 协议： IP报文携带的数据使用的是哪种协议。 以便目的主机的IP层 能知道要将数据报文上交到哪个进程，和端口号类似。 此处采用协议号， TCP的协议号为6 UDP 为17 ICMP为1 IGMP为2

* 首部校验和， 计算IP头部的校验和， 检查IP抱头的完整性， 使用反码求和。

* 源IP， 目的IP



