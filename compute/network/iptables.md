---
网络: iptables
---

# iptables

## 防火墙相关概念

先描述一下相关概念：

### 从逻辑上讲。

 **防火墙可以大体分为主机防火墙和网络防火墙。**

主机防火墙： 针对单个主机进行防护

网络防火墙： 往往处于网络入口或者边缘， 针对网络入口进行防护。服务于防火墙背后的本地局域网。

网络防火墙和主机防火墙并不冲突， 可以理解为， **网络防火墙主外（集体），主机防火墙主内（个人）**

### 从物理上讲

**防火墙可以分为硬件防火墙 和 软件防火墙**

硬件防火墙： 在硬件级别实现部分防火墙功能，另一部分功能基于软件实现，性能高，成本高

软件防火墙： 应勇软件处理逻辑云星宇通用硬件平台之上的防火墙，性能低，成本低。

## iptables

iptables 其实不是真正的防火墙， 我们可以把它理解为一个客户端代理， 用户通过iptables这个代理， 讲用户的安全设定执行到相应的安全框架中， 这个安全框架才是真正的防火墙， 这个框架名字叫 **netfilter**

**netfilter** 才是防火墙真正的安全框架， netfilter 位于内核空间。

iptables 其实是一个命令行工具， 位于用户空间， 我们用这个功能操作真正的框架。

**netfilter/iptables** 组成linux 平台下的包过滤防火墙， 与大多数的Linux 软件一样， 这个包过滤防火墙是免费的。 它可以代替昂贵的商业防火墙解决方案，完成封包过滤， 封包重定向，和网络地址转换NAT等功能。

**Netfilter** 是Linux操作系统核心层内部的一个数据包处理模块， 它具有如下功能：

* 网络地址转换
* 数据包内容修改
* 以及数据包过滤的防火墙功能

所以说， iptables 并没有一个守护进程，iptables 并不能算是真正的服务

## iptables 基础

我们知道iptables 是按照规则办事的。我们就来说说规则（rules）， 规则其实就是网络管理员预定义的条件。**规则一般定义为：如果数据包头符合这样的条件， 就这样处理这个数据包**。规则存储在内核空间的信息报过滤表中，这些规则分别指定了 **源地址、目的地址、传输协议（如TCP UDP ICMP）和服务类型（如HTTP，FTP，SMTP）等**

当数据包与规则匹配时候，iptables就根据规则所定义的方法来处理这些数据包： 如放行（accept）， 拒绝（reject）和丢弃（drop）等。

配置防火墙的主要工作就是 **添加， 修改和删除这些规则**

当客户端访问服务器的web 服务世华， 客户端发送报文到网卡，而TCP IP协议栈是属于内核的一部分。 所以，客户端的信息会通过内核的TCP协议传输到用户空间的web 服务中。 而此时， 客户端报文的目标

终点为web服务所监听的套接字（IP: PORT） 上。当web 服务需要相应客户端请求时候，web 服务发出的相应报文的目标终点为客户端， 这时候web 服务所监听的IP 与端口反而变成了原点， 我们说过netfilter 才是真正的防火墙。 他是内核的一部分， 所以， 如果我们想要防火墙能够达到“防火”的目的， 则需要在内核中设置关卡， 所有进出的报文都要通过这些关卡， 经过检查后， 符合放行条件的才能放行， 符合阻拦条件的则需要组织， 于是就出现了 **input 关卡** **output 关卡**， 而这些关卡在iptables 中不被成为关卡， 而被成为 **链**

![](../../.gitbook/assets/image%20%2830%29.png)

\*\*\*\*

\*\*\*\*

\*\*\*\*

## 引用

{% embed url="http://www.zsythink.net/archives/1199" %}

