---
操作系统: 锁
---

# 锁

## 自旋锁

Linux 自旋锁spinlock 同一时刻只能被一个可执行线程拥有， 当一个线程视图获取已经被持有的spin lock时候， 就会一直循环 -&gt; 选择 等待锁重新可用。忙等待免去了线程挂起再被唤醒的转换。省去了两次上下文切换的时间，因此spinlock 适合下面的场景：

多核系统中， 持有自旋锁的时间小于完成两次上下文切换的时间， 这种场景使用spinlock 效率会比较高。

linux spinlock 在内核中相对比较常见， 因为内核中有很多需要短期加锁的场景， 比如在SMP系统中系统的中断上下文， **但是单核CPU 或者禁止内核抢占时候， 编译的时候自旋锁会被完全提出内核。**

这点不难理解， 本质上串行执行任务时候， 靠时间分片执行各个任务来实现并发，所以单核使用spinlock 会忙等待到时间片用完， 得不偿失。

