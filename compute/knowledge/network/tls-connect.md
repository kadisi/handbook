# tls connect

个人总结：

首先 对于https 在连接建立好后，以后的数据加密都是通过对称加密算法进行加密的，目的是提高性能和速率，非对称加密的目的是加密  对称加密算法的秘钥

单向认证： 大体流程：

* 客户端向服务器端发起tls 版本等信息的请求
* 服务器端返回自己的公钥
* 客户端验证公钥有效性
* 客户端发送自己支持的对称加密算法列表
* 服务器端从中找到一个加密程度最高的算法，并且用明文方式返回给客户端（注意，单向认证是明文方式传输给客户端）
* 客户端随机产生一个随机数 作为对称加密的秘钥，用公钥加密，发送给服务器端
* 服务端使用私钥解密，获得对称加密的秘钥（随机数）
* 后续 客户端和服务器端在传输数时，会用对应的对称加密算法 和 随机数对数据进行加密

双向认证： 

双向认证比单向认证多了一个客户端也要给服务器端发送公钥，同时 对称加密方案。大体流程

* 客户端发送ssl 版本信息
* 服务器端返回ssl 版本信息，服务器公钥
* 客户端校验公钥是否合法
* **客户端校验通过后，发送自己的客户端公钥给服务器端**
* **服务器端验证客户端公钥的合法性**
* 客户端发送自己支持的对称加密方案列表给服务器端
* 服务器端选择一个加密程度高的加密方式
* **服务端用客户端的公钥对加密方案进行加密，发送给客户端（加密方案是密文的）**
* 客户端收到加密方案后，使用私钥进行解密，获得要使用的加密方案，同时客户端产生随机码 作为对称加密方案的秘钥，随机吗用服务器端的公钥加密，发送给服务器端
* 服务器端收到加密的秘钥后，用服务器端的私钥进行解密，获得对称加密的秘钥
* 后续客户端和服务器端数据传输会使用对称加密方案和秘钥进行加密



SSL/TLS在通信中主要有双向认证和单向认证，其原理基本差不多，单向认证中客户端会认证服务器端身份，服务器端不对客户端进行认证 ，双向认证要求客户端和服务端都会互相认证，即双发之间要证书交换 ，具体如下：

SSL/TLS在通信中主要有双向认证和单向认证，其原理基本差不多，单向认证中客户端会认证服务器端身份，服务器端不对客户端进行认证 ，双向认证要求客户端和服务端都会互相认证，即双发之间要证书交换 ，具体如下：

#### 一、SSL协议加密方式 <a id="&#x4E09;ssl&#x534F;&#x8BAE;&#x52A0;&#x5BC6;&#x65B9;&#x5F0F;"></a>

SSL协议即用到了对称加密也用到了非对称加密\(公钥加密\)，在建立传输链路时，SSL首先对对称加密的密钥使用公钥进行非对称加密，链路建立好之后，SSL对传输内容使用对称加密。

1. 对称加密 

   速度高，可加密内容较大，用来加密会话过程中的消息

2. 公钥加密 

   加密速度较慢，但能提供更好的身份认证技术，用来加密对称加密的密钥

#### 二、单向认证 <a id="&#x56DB;&#x5355;&#x5411;&#x8BA4;&#x8BC1;"></a>

Https在建立Socket连接之前，需要进行握手，具体过程如下：

![](../../../.gitbook/assets/image%20%2817%29.png)

1. 客户端向服务端发送SSL协议版本号、加密算法种类、随机数等信息。
2. 服务端给客户端返回SSL协议版本号、加密算法种类、随机数等信息，同时也返回服务器端的证书，即公钥证书
3. 客户端使用服务端返回的信息验证服务器的合法性，包括：

   * 证书是否过期
   * 发型服务器证书的CA是否可靠
   * 返回的公钥是否能正确解开返回证书中的数字签名
   * 服务器证书上的域名是否和服务器的实际域名相匹配

   验证通过后，将继续进行通信，否则，终止通信

4. 客户端向服务端发送自己所能支持的对称加密方案，供服务器端进行选择
5. 服务器端在客户端提供的加密方案中选择加密程度最高的加密方式。
6. 服务器将选择好的加密方案通过明文方式返回给客户端
7. 客户端接收到服务端返回的加密方式后，使用该加密方式生成产生随机码，用作通信过程中对称加密的密钥，使用服务端返回的公钥进行加密，将加密后的随机码发送至服务器
8. 服务器收到客户端返回的加密信息后，使用自己的私钥进行解密，获取对称加密密钥。 

   在接下来的会话中，服务器和客户端将会使用该密码进行对称加密，保证通信过程中信息的安全。

#### 三、双向认证 <a id="&#x4E94;&#x53CC;&#x5411;&#x8BA4;&#x8BC1;"></a>

双向认证和单向认证原理基本差不多，只是除了客户端需要认证服务端以外，增加了服务端对客户端的认证，具体过程如下：

![](../../../.gitbook/assets/image%20%2820%29.png)

1. 客户端向服务端发送SSL协议版本号、加密算法种类、随机数等信息。
2. 服务端给客户端返回SSL协议版本号、加密算法种类、随机数等信息，同时也返回服务器端的证书，即公钥证书
3. 客户端使用服务端返回的信息验证服务器的合法性，包括：

   * 证书是否过期
   * 发型服务器证书的CA是否可靠
   * 返回的公钥是否能正确解开返回证书中的数字签名
   * 服务器证书上的域名是否和服务器的实际域名相匹配

   验证通过后，将继续进行通信，否则，终止通信

4. 服务端要求客户端发送客户端的证书，客户端会将自己的证书发送至服务端
5. 验证客户端的证书，通过验证后，会获得客户端的公钥
6. 客户端向服务端发送自己所能支持的对称加密方案，供服务器端进行选择
7. 服务器端在客户端提供的加密方案中选择加密程度最高的加密方式
8. 将加密方案通过使用之前获取到的公钥进行加密，返回给客户端
9. 客户端收到服务端返回的加密方案密文后，使用自己的私钥进行解密，获取具体加密方式，而后，产生该加密方式的随机码，用作加密过程中的密钥，使用之前从服务端证书中获取到的公钥进行加密后，发送给服务端
10. 服务端收到客户端发送的消息后，使用自己的私钥进行解密，获取对称加密的密钥，在接下来的会话中，服务器和客户端将会使用该密码进行对称加密，保证通信过程中信息的安全。

文章出处：

{% embed url="http://blog.csdn.net/duanbokan/article/details/50847612" %}

参考文章：

{% embed url="http://blog.csdn.net/self\_examination/article/details/47070209" %}

引用：

[https://www.infinisign.com/faq/ssl-tls-authentication](https://www.infinisign.com/faq/ssl-tls-authentication)

